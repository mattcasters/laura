<?xml version="1.0" encoding="UTF-8"?>
<pipeline>
  <info>
    <name>Determine fields</name>
    <name_sync_with_filename>N</name_sync_with_filename>
    <description/>
    <extended_description/>
    <pipeline_version/>
    <pipeline_type>Normal</pipeline_type>
    <pipeline_status>0</pipeline_status>
    <parameters>
      <parameter>
        <name>FILENAME</name>
        <default_value>${PROJECT_HOME}/input/customers.csv</default_value>
        <description>The filename to analyze</description>
      </parameter>
      <parameter>
        <name>LAYOUT_FILE</name>
        <default_value>${PROJECT_HOME}/tmp/Customers-layout.xml</default_value>
        <description>The resulting layout file</description>
      </parameter>
      <parameter>
        <name>PK_FIELD</name>
        <default_value>id</default_value>
        <description>The primary key field</description>
      </parameter>
    </parameters>
    <capture_transform_performance>N</capture_transform_performance>
    <transform_performance_capturing_delay>1000</transform_performance_capturing_delay>
    <transform_performance_capturing_size_limit>100</transform_performance_capturing_size_limit>
    <created_user>-</created_user>
    <created_date>2013/09/23 21:22:25.890</created_date>
    <modified_user>-</modified_user>
    <modified_date>2013/09/23 21:22:25.890</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
    <notepad>
      <note>TODO: support proper 
enclosures in header</note>
      <xloc>272</xloc>
      <yloc>144</yloc>
      <width>126</width>
      <heigth>42</heigth>
      <fontname>Noto Sans</fontname>
      <fontsize>11</fontsize>
      <fontbold>N</fontbold>
      <fontitalic>N</fontitalic>
      <fontcolorred>14</fontcolorred>
      <fontcolorgreen>58</fontcolorgreen>
      <fontcolorblue>90</fontcolorblue>
      <backgroundcolorred>201</backgroundcolorred>
      <backgroundcolorgreen>232</backgroundcolorgreen>
      <backgroundcolorblue>251</backgroundcolorblue>
      <bordercolorred>14</bordercolorred>
      <bordercolorgreen>58</bordercolorgreen>
      <bordercolorblue>90</bordercolorblue>
    </notepad>
  </notepads>
  <order>
    <hop>
      <from>read lines from file</from>
      <to>First row only</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>pick field</from>
      <to>Add constants</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Add constants</from>
      <to>Template: Metadata detector - Parser.hpl</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Template: Metadata detector - Parser.hpl</from>
      <to>Patch result fields design time</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>filename</from>
      <to>Template: Metadata detector - Parser.hpl</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>line to field</from>
      <to>pick field</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>field=pkField?</from>
      <to>primary=false</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>field=pkField?</from>
      <to>primary=true</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>primary=false</from>
      <to>properties</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>primary=true</from>
      <to>properties</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>properties</from>
      <to>layout.xml</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Patch result fields design time</from>
      <to>pkField</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>pkField</from>
      <to>field=pkField?</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>First row only</from>
      <to>remove "</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>remove "</from>
      <to>line to field</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <transform>
    <name>Add constants</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>type</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>String</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>624</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform>
    <name>First row only</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to/>
    <send_false_to/>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>nr</leftvalue>
        <function>=</function>
        <rightvalue/>
        <value>
          <name>constant</name>
          <type>Integer</type>
          <text>1</text>
          <length>-1</length>
          <precision>0</precision>
          <isnull>N</isnull>
          <mask>#;-#</mask>
        </value>
      </condition>
    </compare>
    <attributes/>
    <GUI>
      <xloc>208</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Patch result fields design time</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>field</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldType</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldLength</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldPrecision</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldConversionMask</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldDecimal</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>fieldGroup</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>848</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>Template: Metadata detector - Parser.hpl</name>
    <type>MetaInject</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <filename>${PROJECT_HOME}/hop/meta-detector/Metadata detector - Parser.hpl</filename>
    <source_transform>select result fields</source_transform>
    <source_output_fields>    </source_output_fields>
    <target_file/>
    <no_execution>N</no_execution>
    <stream_source_transform/>
    <stream_target_transform/>
    <mappings>
      <mapping>
        <target_transform_name>CSV file input</target_transform_name>
        <target_attribute_key>FILENAME</target_attribute_key>
        <target_detail>N</target_detail>
        <source_transform>filename</source_transform>
        <source_field>filename</source_field>
      </mapping>
      <mapping>
        <target_transform_name>CSV file input</target_transform_name>
        <target_attribute_key>FIELD_TYPE</target_attribute_key>
        <target_detail>Y</target_detail>
        <source_transform>Add constants</source_transform>
        <source_field>type</source_field>
      </mapping>
      <mapping>
        <target_transform_name>CSV file input</target_transform_name>
        <target_attribute_key>INPUT_NAME</target_attribute_key>
        <target_detail>Y</target_detail>
        <source_transform>Add constants</source_transform>
        <source_field>field</source_field>
      </mapping>
    </mappings>
    <attributes/>
    <GUI>
      <xloc>624</xloc>
      <yloc>241</yloc>
    </GUI>
  </transform>
  <transform>
    <name>field=pkField?</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>primary=true</send_true_to>
    <send_false_to>primary=false</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>field</leftvalue>
        <function>=</function>
        <rightvalue>pkField</rightvalue>
      </condition>
    </compare>
    <attributes/>
    <GUI>
      <xloc>592</xloc>
      <yloc>400</yloc>
    </GUI>
  </transform>
  <transform>
    <name>filename</name>
    <type>GetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>filename</name>
        <variable>${FILENAME}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>438</xloc>
      <yloc>241</yloc>
    </GUI>
  </transform>
  <transform>
    <name>layout.xml</name>
    <type>XMLOutput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <encoding>UTF-8</encoding>
    <name_space/>
    <xml_main_element>fields</xml_main_element>
    <xml_repeat_element>field</xml_repeat_element>
    <file>
      <name>${LAYOUT_FILE}</name>
      <extention/>
      <servlet_output>N</servlet_output>
      <do_not_open_newfile_init>N</do_not_open_newfile_init>
      <split>N</split>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <omit_null_values>N</omit_null_values>
      <date_time_format/>
      <add_to_result_filenames>N</add_to_result_filenames>
      <zipped>N</zipped>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <content_type>Element</content_type>
        <name>field</name>
        <element>name</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldType</name>
        <element>type</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldLength</name>
        <element>length</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldPrecision</name>
        <element>precision</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldConversionMask</name>
        <element>mask</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldDecimal</name>
        <element>decimal</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>fieldGroup</name>
        <element>group</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>primary</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>propertyName</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <content_type>Element</content_type>
        <name>propertyType</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>1120</xloc>
      <yloc>400</yloc>
    </GUI>
  </transform>
  <transform>
    <name>line to field</name>
    <type>SplitFieldToRows3</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <splitfield>line</splitfield>
    <delimiter>${DELIMITER}</delimiter>
    <newfield>field</newfield>
    <rownum>Y</rownum>
    <rownum_field>nr</rownum_field>
    <resetrownumber>Y</resetrownumber>
    <delimiter_is_regex>N</delimiter_is_regex>
    <attributes/>
    <GUI>
      <xloc>432</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform>
    <name>pick field</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>field</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <GUI>
      <xloc>528</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform>
    <name>pkField</name>
    <type>GetVariable</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>pkField</name>
        <variable>${PK_FIELD}</variable>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>1008</xloc>
      <yloc>240</yloc>
    </GUI>
  </transform>
  <transform>
    <name>primary=false</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>primary</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>false</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>752</xloc>
      <yloc>480</yloc>
    </GUI>
  </transform>
  <transform>
    <name>primary=true</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>primary</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>true</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>752</xloc>
      <yloc>400</yloc>
    </GUI>
  </transform>
  <transform>
    <name>properties</name>
    <type>ScriptValueMod</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <optimizationLevel>9</optimizationLevel>
    <jsScripts>
      <jsScript>
        <jsScript_type>0</jsScript_type>
        <jsScript_name>Script 1</jsScript_name>
        <jsScript_script>
var n2 = replace(initCap(field), " ", "" );
var n3 = replace(n2, "_", "" );
var clean = replace(n3, "\\.", "");
var propertyName = substr(lower(clean), 0,1);
if (clean.length>1) {
  propertyName+=substr(initCap(clean), 1)
}

var propertyType = fieldType;

if (fieldType.equals("Date")) {
  propertyType = "LocalDateTime";
}
if (fieldType.equals("Number")) {
  propertyType = "Float";
}
if (fieldType.equals("BigNumber")) {
  propertyType = "String";
}
</jsScript_script>
      </jsScript>
    </jsScripts>
    <fields>
      <field>
        <name>propertyName</name>
        <rename>propertyName</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
      <field>
        <name>propertyType</name>
        <rename>propertyType</rename>
        <type>String</type>
        <length>-1</length>
        <precision>-1</precision>
        <replace>N</replace>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>880</xloc>
      <yloc>400</yloc>
    </GUI>
  </transform>
  <transform>
    <name>read lines from file</name>
    <type>CSVInput</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <filename>${FILENAME}</filename>
    <filename_field/>
    <rownum_field>nr</rownum_field>
    <include_filename>N</include_filename>
    <separator>[@/=</separator>
    <enclosure>"</enclosure>
    <header>N</header>
    <buffer_size>50000</buffer_size>
    <lazy_conversion>N</lazy_conversion>
    <add_filename_result>N</add_filename_result>
    <parallel>N</parallel>
    <newline_possible>N</newline_possible>
    <encoding/>
    <fields>
      <field>
        <name>line</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <length>-1</length>
        <precision>-1</precision>
        <trim_type>none</trim_type>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>80</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform>
    <name>remove "</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>line</in_stream_name>
        <out_stream_name/>
        <use_regex>no</use_regex>
        <replace_string>"</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <GUI>
      <xloc>320</xloc>
      <yloc>64</yloc>
    </GUI>
  </transform>
  <transform_error_handling>
  </transform_error_handling>
  <attributes>
    <group>
      <name>DataService</name>
    </group>
  </attributes>
</pipeline>
